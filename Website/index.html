<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLS '96 Cup - 2025 Season</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Use the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple animation for page load */
        .fade-in {
            animation: fadeIn 1s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header and Navigation Bar -->
    <header class="bg-white shadow-md sticky top-0 z-10">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold text-gray-900 flex items-center">
                <img src="img/logo.png" alt="MLS'96 Cup Logo" class="h-8 w-8 mr-2">
                MLS'96<span class="text-blue-600">Cup</span>
            </a>
            
            <!-- Mobile Menu Button -->
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-gray-900 focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>

            <!-- Desktop Menu -->
            <div id="desktop-menu" class="hidden md:flex items-center space-x-6">
                <a href="index.html" class="text-blue-600 font-semibold border-b-2 border-blue-600">Home</a>
                <a href="about.html" class="hover:text-blue-600">About</a>
                <a href="join.html" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition">Join Committee</a>
            </div>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4 space-y-2 bg-white shadow-md">
            <a href="index.html" class="block text-blue-600 font-semibold">Home</a>
            <a href="about.html" class="block hover:text-blue-600">About</a>
            <a href="join.html" class="block bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition text-center">Join Committee</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8 fade-in">
        
        <!-- Page Title and Intro -->
        <div class="text-center mb-12">
            <h1 id="season-title" class="text-4xl font-bold text-gray-900 mb-2">MLS '96 Cup - 2025 Season</h1>
            <p id="covid-warning" class="text-red-600 font-semibold hidden">Note: 2020 is considered an invalid season due to the COVID-19 pandemic.</p>
            <p class="text-lg text-gray-600">A fan-led competition tracking the head-to-head results of the 10 original MLS clubs.</p>
            <!-- Year Selector Dropdown -->
            <div class="mt-4">
                <label for="year-selector" class="mr-2 font-medium text-gray-700">Select Season:</label>
                <select id="year-selector" class="p-2 rounded-md border-gray-300 bg-white shadow-sm focus:border-blue-500 focus:ring-blue-500"></select>
            </div>
        </div>

        <!-- Champions Section -->
        <div id="champions-section" class="text-center mb-12 bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-3xl font-bold text-gray-900 mb-4">Season Champions</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <h3 class="text-xl font-semibold text-gray-700">Eastern Conference</h3>
                    <p id="east-champion" class="text-2xl text-blue-600 font-bold mt-1">-</p>
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-gray-700">Overall Champion</h3>
                    <p id="overall-champion" class="text-2xl text-yellow-500 font-bold mt-1">-</p>
                    <p id="overall-champion-details" class="text-sm text-gray-500 mt-1">&nbsp;</p>
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-gray-700">Western Conference</h3>
                    <p id="west-champion" class="text-2xl text-blue-600 font-bold mt-1">-</p>
                </div>
            </div>
             <!-- Decisive Matches Toggle Button -->
            <div class="mt-6">
                <button id="toggle-decisive-table" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-300 transition">
                    Show Decisive Matchup Table
                </button>
            </div>
        </div>

        <!-- Decisive Matches Table (Initially Hidden) -->
        <div id="decisive-table-container" class="hidden mb-12 bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-4 text-center text-gray-900">Decisive Matchups</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full text-left border-collapse">
                    <thead id="decisive-table-head" class="bg-gray-50">
                        <!-- Header will be populated by JS -->
                    </thead>
                    <tbody id="decisive-table-body" class="divide-y">
                        <!-- Body will be populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>


        <!-- Standings Tables -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
            <!-- Eastern Conference Table -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Eastern Conference</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full text-left">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2">Team</th>
                                <th class="px-4 py-2">Pts</th>
                                <th class="px-4 py-2">GP</th>
                                <th class="px-4 py-2">W</th>
                                <th class="px-4 py-2">L</th>
                                <th class="px-4 py-2">D</th>
                                <th class="px-4 py-2">GF</th>
                                <th class="px-4 py-2">GA</th>
                                <th class="px-4 py-2">GD</th>
                            </tr>
                        </thead>
                        <tbody id="east-standings" class="divide-y">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Western Conference Table -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Western Conference</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full text-left">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2">Team</th>
                                <th class="px-4 py-2">Pts</th>
                                <th class="px-4 py-2">GP</th>
                                <th class="px-4 py-2">W</th>
                                <th class="px-4 py-2">L</th>
                                <th class="px-4 py-2">D</th>
                                <th class="px-4 py-2">GF</th>
                                <th class="px-4 py-2">GA</th>
                                <th class="px-4 py-2">GD</th>
                            </tr>
                        </thead>
                        <tbody id="west-standings" class="divide-y">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Games Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Eastern Conference Matches -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4">Eastern Conference Matches</h2>
                <ul id="east-matches" class="space-y-3">
                    <!-- Data will be loaded here -->
                </ul>
            </div>
            
            <!-- Western Conference Matches -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4">Western Conference Matches</h2>
                <ul id="west-matches" class="space-y-3">
                    <!-- Data will be loaded here -->
                </ul>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white mt-12 py-6 border-t">
        <div class="container mx-auto text-center text-gray-600">
            <p>&copy; 2025 MLS96cup.com - A Fan Project</p>
        </div>
    </footer>

    <script>
        // --- SCRIPT TO LOAD DATA FROM CSV FILES ---

        document.addEventListener('DOMContentLoaded', () => {
            
            const yearSelector = document.getElementById('year-selector');
            const seasonTitle = document.getElementById('season-title');
            const covidWarning = document.getElementById('covid-warning');
            const toggleButton = document.getElementById('toggle-decisive-table');
            const decisiveTableContainer = document.getElementById('decisive-table-container');

            const easternTeams = ["New England Revolution", "New York Red Bulls", "D.C. United", "Columbus Crew", "Chicago Fire FC"];
            const westernTeams = ["LA Galaxy", "San Jose Earthquakes", "Colorado Rapids", "Sporting Kansas City", "FC Dallas"];

            // Function to populate the year selector dropdown
            function populateYearSelector() {
                const startYear = 2025;
                const endYear = 2015;
                for (let year = startYear; year >= endYear; year--) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearSelector.appendChild(option);
                }
            }

            // Function to fetch and parse CSV data, now with caching disabled
            async function fetchCsvData(filePath) {
                try {
                    // Add { cache: 'no-cache' } to prevent the browser from using old files
                    const response = await fetch(filePath, { cache: 'no-cache' });
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status} for file ${filePath}`);
                    }
                    const text = await response.text();
                    // Return empty array if file is empty to avoid errors
                    if (text.trim() === '') return [];
                    return text.trim().split('\n').map(row => row.split(','));
                } catch (error) {
                    console.error(`Error fetching or parsing CSV from ${filePath}:`, error);
                    // Clear the relevant table/list on error to indicate missing data
                    let elementId;
                    if (filePath.includes('eastern_standings')) elementId = 'east-standings';
                    else if (filePath.includes('western_standings')) elementId = 'west-standings';
                    else if (filePath.includes('eastern_matches')) elementId = 'east-matches';
                    else if (filePath.includes('western_matches')) elementId = 'west-matches';

                    if (elementId) {
                        const element = document.getElementById(elementId);
                        if (element) {
                            if (element.tagName.toLowerCase() === 'tbody') {
                                element.innerHTML = `<tr><td colspan="9" class="text-center p-4 text-red-500">Could not load data.</td></tr>`;
                            } else {
                                element.innerHTML = `<li class="text-center p-4 text-red-500">Could not load data.</li>`;
                            }
                        }
                    }
                    return []; // Return empty array on error
                }
            }

            // Function to populate a standings table
            function populateStandings(tableBodyId, data) {
                const tableBody = document.getElementById(tableBodyId);
                if (!tableBody) return;
                if(data.length < 2) {
                    tableBody.innerHTML = `<tr><td colspan="9" class="text-center p-4 text-gray-500">No standings data available for this year.</td></tr>`;
                    return;
                }

                const headers = data[0].map(h => h.trim());
                const rows = data.slice(1);

                const headerMap = {
                    team: headers.indexOf('team_name'),
                    pts: headers.indexOf('points'),
                    gp: headers.indexOf('games_played'),
                    w: headers.indexOf('wins'),
                    l: headers.indexOf('losses'),
                    d: headers.indexOf('draws'),
                    gf: headers.indexOf('goals_scored'),
                    ga: headers.indexOf('goals_conceded'),
                    gd: headers.indexOf('goal_differential')
                };

                if (Object.values(headerMap).some(index => index === -1)) {
                    console.error(`Standings CSV for #${tableBodyId} is missing required headers.`);
                    tableBody.innerHTML = `<tr><td colspan="9" class="text-center p-4 text-red-500">Standings data is missing required columns. Please regenerate the data.</td></tr>`;
                    return;
                }
                
                tableBody.innerHTML = '';

                rows.forEach((rowData, index) => {
                    const tr = document.createElement('tr');
                    const teamName = rowData[headerMap.team];
                    const teamClass = teamName.includes('Mutiny') ? 'text-gray-500' : 'font-medium';
                    
                    if (index === 0) {
                        tr.classList.add('border-b-2', 'border-dotted', 'border-gray-400');
                    }

                    tr.innerHTML = `
                        <td class="px-4 py-2 ${teamClass}">${teamName}</td>
                        <td class="px-4 py-2 font-bold ${teamClass === 'text-gray-500' ? 'text-gray-500' : ''}">${rowData[headerMap.pts]}</td>
                        <td class="px-4 py-2 ${teamClass === 'text-gray-500' ? 'text-gray-500' : ''}">${rowData[headerMap.gp]}</td>
                        <td class="px-4 py-2 ${teamClass === 'text-gray-500' ? 'text-gray-500' : ''}">${rowData[headerMap.w]}</td>
                        <td class="px-4 py-2 ${teamClass === 'text-gray-500' ? 'text-gray-500' : ''}">${rowData[headerMap.l]}</td>
                        <td class="px-4 py-2 ${teamClass === 'text-gray-500' ? 'text-gray-500' : ''}">${rowData[headerMap.d]}</td>
                        <td class="px-4 py-2 ${teamClass === 'text-gray-500' ? 'text-gray-500' : ''}">${rowData[headerMap.gf]}</td>
                        <td class="px-4 py-2 ${teamClass === 'text-gray-500' ? 'text-gray-500' : ''}">${rowData[headerMap.ga]}</td>
                        <td class="px-4 py-2 ${teamClass === 'text-gray-500' ? 'text-gray-500' : ''}">${rowData[headerMap.gd]}</td>
                    `;
                    tableBody.appendChild(tr);
                });
            }

            // Function to populate a sorted match list
            function populateMatches(listId, data) {
                const list = document.getElementById(listId);
                if (!list) return;
                if(data.length < 2) {
                    list.innerHTML = `<li class="text-center p-4 text-gray-500">No match data available for this year.</li>`;
                    return;
                }


                const headers = data[0].map(h => h.trim());
                const rows = data.slice(1);

                const headerMap = {
                    date: headers.indexOf('date_time_utc'),
                    home: headers.indexOf('home_team'),
                    away: headers.indexOf('away_team'),
                    homeScore: headers.indexOf('home_score'),
                    awayScore: headers.indexOf('away_score'),
                    status: headers.indexOf('status')
                };

                if (Object.values(headerMap).some(index => index === -1)) {
                    console.error(`Matches CSV for #${listId} is missing required headers.`);
                    return;
                }

                rows.sort((a, b) => new Date(a[headerMap.date]) - new Date(b[headerMap.date]));

                list.innerHTML = '';

                rows.forEach(gameData => {
                    const li = document.createElement('li');
                    li.className = 'border-b pb-2';
                    
                    const homeTeam = gameData[headerMap.home];
                    const awayTeam = gameData[headerMap.away];
                    const status = gameData[headerMap.status];
                    const homeScore = gameData[headerMap.homeScore];
                    const awayScore = gameData[headerMap.awayScore];
                    
                    const displayDate = new Date(gameData[headerMap.date]).toLocaleDateString('en-US', {
                        year: 'numeric', month: 'long', day: 'numeric'
                    });

                    let matchHtml;
                    if (status === 'FullTime' && homeScore && awayScore) {
                        const score = `${homeScore} - ${awayScore}`;
                        matchHtml = `<p>${homeTeam} <span class="font-bold text-blue-600">${score}</span> ${awayTeam}</p>`;
                    } else {
                        matchHtml = `<p>${homeTeam} vs ${awayTeam}</p>`;
                    }
                    
                    li.innerHTML = `
                        <p class="text-sm text-gray-500">${displayDate}</p>
                        ${matchHtml}
                    `;
                    list.appendChild(li);
                });
            }

            // Function to populate the champions section
            function populateChampions(eastStandings, westStandings, decisiveMatches) {
                const eastChampEl = document.getElementById('east-champion');
                const westChampEl = document.getElementById('west-champion');
                const overallChampEl = document.getElementById('overall-champion');
                const overallChampDetailsEl = document.getElementById('overall-champion-details');

                let eastChamp = "-";
                let westChamp = "-";
                let overallChamp = "-";
                let champDetails = "&nbsp;"; // Use non-breaking space to maintain height

                // Get East Champion
                if (eastStandings.length > 1) {
                    eastChamp = eastStandings[1][0]; // First team in the standings
                }
                
                // Get West Champion
                if (westStandings.length > 1) {
                    westChamp = westStandings[1][0]; // First team in the standings
                }

                // Get Overall Champion from decisive matches
                if (decisiveMatches.length > 1 && eastChamp !== "-" && westChamp !== "-") {
                    const headers = decisiveMatches[0].map(h => h.trim());
                    const winnerIndex = headers.indexOf('Winner');
                    const matchIndex = headers.indexOf('Match');
                    const scoreIndex = headers.indexOf('Score');
                    const dateIndex = headers.indexOf('Date');

                    if (winnerIndex !== -1 && matchIndex !== -1) {
                        const finalMatch = decisiveMatches.slice(1).find(row => {
                            const matchText = row[matchIndex];
                            return matchText.includes(eastChamp) && matchText.includes(westChamp);
                        });

                        if (finalMatch) {
                            overallChamp = finalMatch[winnerIndex];
                            const rawDate = finalMatch[dateIndex];
                            const dateParts = rawDate.split('-');
                            const decisiveDate = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
                            const formattedDate = decisiveDate.toLocaleDateString('en-US', {
                                year: 'numeric', month: 'long', day: 'numeric'
                            });
                            champDetails = `${formattedDate} (${finalMatch[scoreIndex]})`;
                        }
                    }
                }
                
                eastChampEl.textContent = eastChamp;
                westChampEl.textContent = westChamp;
                overallChampEl.textContent = overallChamp;
                overallChampDetailsEl.innerHTML = champDetails;

                return { eastChamp, westChamp };
            }

            // Function to populate the decisive matches table
            function populateDecisiveTable(decisiveMatches, eastChamp, westChamp) {
                const tableHead = document.getElementById('decisive-table-head');
                const tableBody = document.getElementById('decisive-table-body');
                
                tableHead.innerHTML = '';
                tableBody.innerHTML = '';

                if (decisiveMatches.length < 2) {
                    toggleButton.style.display = 'none';
                    return;
                }
                toggleButton.style.display = 'inline-block';

                const headers = decisiveMatches[0].map(h => h.trim());
                const rows = decisiveMatches.slice(1);
                const headerMap = {
                    date: headers.indexOf('Date'),
                    match: headers.indexOf('Match'),
                    score: headers.indexOf('Score'),
                    winner: headers.indexOf('Winner')
                };

                // Create Header
                const headerRow = document.createElement('tr');
                headerRow.innerHTML = `<th class="px-4 py-2 border">West \\ East</th>`;
                easternTeams.forEach(team => {
                    headerRow.innerHTML += `<th class="px-4 py-2 border">${team}</th>`;
                });
                tableHead.appendChild(headerRow);

                // Create Body Rows
                westernTeams.forEach(westTeam => {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td class="px-4 py-2 border font-semibold">${westTeam}</td>`;
                    easternTeams.forEach(eastTeam => {
                        const matchData = rows.find(r => {
                            const matchText = r[headerMap.match];
                            return matchText.includes(westTeam) && matchText.includes(eastTeam);
                        });

                        let cellClass = "px-4 py-2 border text-sm";
                        if (westTeam === westChamp && eastTeam === eastChamp) {
                            cellClass += " bg-yellow-200";
                        }

                        if (matchData) {
                            const date = new Date(matchData[headerMap.date]).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
                            const score = matchData[headerMap.score];
                            const winner = matchData[headerMap.winner];
                            row.innerHTML += `
                                <td class="${cellClass}">
                                    <p class="font-bold">${winner}</p>
                                    <p class="text-gray-600">${score}</p>
                                    <p class="text-gray-400">${date}</p>
                                </td>`;
                        } else {
                            row.innerHTML += `<td class="${cellClass} text-center text-gray-400">-</td>`;
                        }
                    });
                    tableBody.appendChild(row);
                });
            }

            // Main function to load all data for a given year
            async function loadAllData(year) {
                seasonTitle.textContent = `MLS '96 Cup - ${year} Season`;

                if (year === '2020') {
                    covidWarning.classList.remove('hidden');
                } else {
                    covidWarning.classList.add('hidden');
                }
                
                const [eastStandings, westStandings, eastMatches, westMatches, decisiveMatches] = await Promise.all([
                    fetchCsvData(`${year}/eastern_standings_${year}.csv`),
                    fetchCsvData(`${year}/western_standings_${year}.csv`),
                    fetchCsvData(`${year}/eastern_matches_${year}.csv`),
                    fetchCsvData(`${year}/western_matches_${year}.csv`),
                    fetchCsvData(`${year}/decisive_matches_${year}.csv`)
                ]);

                populateStandings('east-standings', eastStandings);
                populateStandings('west-standings', westStandings);
                populateMatches('east-matches', eastMatches);
                populateMatches('west-matches', westMatches);
                const champions = populateChampions(eastStandings, westStandings, decisiveMatches);
                populateDecisiveTable(decisiveMatches, champions.eastChamp, champions.westChamp);
            }

            // --- Initial Page Setup ---
            populateYearSelector();
            loadAllData(yearSelector.value); // Load data for the default year

            // Event listener for when the user selects a new year
            yearSelector.addEventListener('change', (event) => {
                loadAllData(event.target.value);
            });

            // Mobile menu toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            // Decisive table toggle
            toggleButton.addEventListener('click', () => {
                const isHidden = decisiveTableContainer.classList.contains('hidden');
                decisiveTableContainer.classList.toggle('hidden');
                toggleButton.textContent = isHidden ? 'Hide Decisive Matchup Table' : 'Show Decisive Matchup Table';
            });
        });
    </script>
    
</body>
</html>
